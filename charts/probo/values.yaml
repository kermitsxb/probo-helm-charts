# Default values for probo.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

replicaCount: 1

image:
  repository: ghcr.io/getprobo/probo
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion.
  tag: ""

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Automatically mount a ServiceAccount's API credentials?
  automount: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""

podAnnotations: {}
podLabels: {}

podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000

securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
    - ALL
  readOnlyRootFilesystem: true

service:
  type: ClusterIP
  port: 8080
  # nodePort: 30080
  # clusterIP: ""
  # loadBalancerIP: ""
  # loadBalancerSourceRanges: []
  annotations: {}

ingress:
  enabled: false
  className: ""
  annotations: {}
    # cert-manager.io/cluster-issuer: letsencrypt-prod
    # nginx.ingress.kubernetes.io/ssl-redirect: "true"
  hosts:
    - host: probo.example.com
      paths:
        - path: /
          pathType: Prefix
  tls: []
  #  - secretName: probo-tls
  #    hosts:
  #      - probo.example.com

resources:
  limits:
    cpu: 2000m
    memory: 2Gi
  requests:
    cpu: 500m
    memory: 512Mi

livenessProbe:
  httpGet:
    path: /
    port: http
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 6

readinessProbe:
  httpGet:
    path: /
    port: http
  initialDelaySeconds: 10
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 3

autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 10
  targetCPUUtilizationPercentage: 80
  # targetMemoryUtilizationPercentage: 80

# Additional volumes on the output Deployment definition.
volumes: []
# - name: foo
#   secret:
#     secretName: mysecret
#     optional: false

# Additional volumeMounts on the output Deployment definition.
volumeMounts: []
# - name: foo
#   mountPath: "/etc/foo"
#   readOnly: true

nodeSelector: {}

tolerations: []

affinity: {}

# Persistent data volume
persistence:
  enabled: false
  # existingClaim: ""
  storageClass: ""
  accessMode: ReadWriteOnce
  size: 10Gi
  annotations: {}

# Prometheus Operator ServiceMonitor
metrics:
  serviceMonitor:
    enabled: false
    interval: 30s
    scrapeTimeout: 10s
    labels: {}
    relabelings: []

# Probo application configuration
probo:
  # Public hostname where Probo will be accessible
  # This should match your ingress host
  hostname: probo.example.com

  # Base64-encoded encryption key (REQUIRED)
  # Generate with: openssl rand -base64 32
  encryptionKey: ""

  service:
    port: 8080

  metrics:
    port: 8081

  # OpenTelemetry tracing configuration
  tracing:
    enabled: false
    # OTLP gRPC endpoint (e.g., tempo:4317)
    addr: ""
    maxBatchSize: 512
    batchTimeout: 5
    exportTimeout: 30
    maxQueueSize: 2048

  # CORS configuration
  cors:
    allowedOrigins:
      - "https://probo.example.com"

  # Extra HTTP headers to add to responses
  extraHeaderFields: {}

  # Authentication configuration
  auth:
    disableSignup: false
    invitationTokenValidity: 3600
    cookieName: "SSID"
    cookieDomain: "probo.example.com"
    # Cookie signing secret (REQUIRED, at least 32 bytes)
    # Generate with: openssl rand -base64 32
    cookieSecret: ""
    cookieDuration: 24
    # Password hashing pepper (REQUIRED, at least 32 bytes)
    # Generate with: openssl rand -base64 32
    passwordPepper: ""
    passwordIterations: 1000000

  # Trust center authentication
  trustAuth:
    cookieName: "TCT"
    cookieDomain: "probo.example.com"
    cookieDuration: 24
    tokenDuration: 168
    reportUrlDuration: 15
    # Trust token signing secret (REQUIRED, at least 32 bytes)
    # Generate with: openssl rand -base64 32
    tokenSecret: ""
    scope: "trust_center_readonly"
    tokenType: "trust_center_access"

  # Email configuration
  mailer:
    senderName: "Probo"
    senderEmail: "no-reply@notification.getprobo.com"
    smtp:
      addr: "localhost:1025"
      user: ""
      password: ""
      tlsRequired: false

  # OpenAI integration (optional)
  openai:
    apiKey: ""
    temperature: 0.1
    modelName: "gpt-4o"

  # Custom domains configuration (optional)
  customDomains:
    enabled: false
    renewalInterval: 3600
    provisionInterval: 30
    cnameTarget: "probo.example.com"
    acme:
      directory: "https://acme-v02.api.letsencrypt.org/directory"
      email: "admin@example.com"
      keyType: "EC256"
      insecureTls: false

  # External OAuth2 connectors (optional)
  connectors: []
  # - name: "github"
  #   type: "oauth2"
  #   config:
  #     client-id: "github-client-id"
  #     client-secret: "github-client-secret"
  #     redirect-uri: "https://probo.example.com/api/console/v1/connectors/complete"
  #     auth-url: "https://github.com/login/oauth/authorize"
  #     token-url: "https://github.com/login/oauth/access_token"

# PostgreSQL configuration (External - REQUIRED)
# Use a managed PostgreSQL service (AWS RDS, GCP Cloud SQL, Azure Database, etc.)
postgresql:
  host: ""  # REQUIRED: PostgreSQL hostname
  port: 5432
  database: "probod"
  username: "probod"
  password: ""  # REQUIRED: PostgreSQL password
  poolSize: 100
  # CA certificate bundle for TLS connections (optional)
  caCertBundle: ""

# S3 storage configuration (REQUIRED)
# Use AWS S3 or S3-compatible storage
s3:
  region: "us-east-1"
  bucket: "probod"
  # For AWS S3, leave endpoint empty
  # For S3-compatible storage (MinIO, DigitalOcean Spaces, etc.), set the endpoint
  endpoint: ""
  accessKeyId: ""  # REQUIRED: S3 access key
  secretAccessKey: ""  # REQUIRED: S3 secret key

# Headless Chrome for PDF generation
chrome:
  # Deploy Chrome in the cluster
  enabled: true

  replicaCount: 1

  image:
    repository: chromedp/headless-shell
    tag: "140.0.7259.2"
    pullPolicy: IfNotPresent

  resources:
    limits:
      cpu: 1000m
      memory: 1Gi
    requests:
      cpu: 100m
      memory: 256Mi

  # External Chrome configuration
  # Used when chrome.enabled=false
  external:
    addr: ""
